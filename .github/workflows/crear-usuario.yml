name: Crear README.md para nuevo usuario

on:
  push:
    paths:
      - 'Usuarios/**'

jobs:
  create_readme:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repositorio
        uses: actions/checkout@v2

      - name: Crear README.md para nuevo usuario
        run: |
          # Obtener el nombre del directorio del usuario desde el evento de push
          USER_DIR_PATH=$(echo ${GITHUB_REF} | sed 's/refs\/heads\/main\///g')

          # Verificar si la variable USER_DIR_PATH tiene contenido
          if [ -n "$USER_DIR_PATH" ]; then
            # Crear el archivo README.md con las instrucciones para el nuevo usuario
            echo "# Bienvenido a tu perfil en BookTrack, ${USER_DIR_PATH}!" > "Usuarios/${USER_DIR_PATH}/README.md"
            echo "" >> "Usuarios/${USER_DIR_PATH}/README.md"
            echo "## Pasos para comenzar:" >> "Usuarios/${USER_DIR_PATH}/README.md"
            echo "1. **Sube tus libros** 📚" >> "Usuarios/${USER_DIR_PATH}/README.md"
            echo "   Crea un archivo con el nombre del libro y detalles (autor, descripción, etc.) dentro de la carpeta \`Libros/\`." >> "Usuarios/${USER_DIR_PATH}/README.md"
            echo "2. **Únete a un club** 📖" >> "Usuarios/${USER_DIR_PATH}/README.md"
            echo "   Visita la carpeta \`Clubs/\` y únete al club que más te interese." >> "Usuarios/${USER_DIR_PATH}/README.md"
            echo "3. **Actualiza tu perfil** ✍️" >> "Usuarios/${USER_DIR_PATH}/README.md"
            echo "   Actualiza tu archivo \`PERFIL.md\` con la información de tus libros y clubes." >> "Usuarios/${USER_DIR_PATH}/README.md"

            # Hacer commit y push de los cambios
            git add "Usuarios/${USER_DIR_PATH}/README.md"
            git commit -m "Crear README.md para el usuario ${USER_DIR_PATH}"
            git push
          else
            echo "No se pudo identificar la ruta del usuario"
            exit 1
          fi
